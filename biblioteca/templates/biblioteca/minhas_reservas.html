{% extends 'base.html' %}
{% load static %}

{% block title %}Minhas Reservas - Sistema de Biblioteca SENAC{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'biblioteca:dashboard' %}">
                <i class="fas fa-home me-1"></i>Dashboard
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Minhas Reservas</li>
    </ol>
</nav>

<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h2 mb-1">
                    <i class="fas fa-bookmark text-primary me-2"></i>
                    Minhas Reservas
                </h1>
                <p class="text-muted mb-0">Gerencie suas reservas de livros</p>
            </div>
            
            <!-- Quick Actions -->
            <div class="d-flex gap-2">
                <a href="{% url 'biblioteca:livro_list' %}" class="btn btn-outline-primary">
                    <i class="fas fa-search me-2"></i>Buscar Livros
                </a>
                <a href="{% url 'biblioteca:dashboard' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Summary -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stats-card">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <h5>Total de Reservas</h5>
                    <h2>{{ total_reservas|default:0 }}</h2>
                </div>
                <div class="ms-3">
                    <i class="fas fa-bookmark fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #198754, #146c43);">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <h5>Reservas Ativas</h5>
                    <h2>{{ reservas_ativas|length|default:0 }}</h2>
                </div>
                <div class="ms-3">
                    <i class="fas fa-check-circle fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #ffc107, #e0a800);">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <h5>Expirando em Breve</h5>
                    <h2>{{ reservas_expirando|length|default:0 }}</h2>
                </div>
                <div class="ms-3">
                    <i class="fas fa-clock fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #6c757d, #495057);">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <h5>Histórico</h5>
                    <h2>{{ reservas_historico|length|default:0 }}</h2>
                </div>
                <div class="ms-3">
                    <i class="fas fa-history fa-2x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Active Reservations -->
{% if reservas_ativas %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-check-circle me-2"></i>
                    Reservas Ativas ({{ reservas_ativas|length }})
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for reserva in reservas_ativas %}
                    <div class="col-lg-6 col-md-12 mb-3">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <div class="row">
                                    <!-- Book Cover -->
                                    <div class="col-md-3 text-center mb-3">
                                        {% if reserva.livro.capa %}
                                            <img src="{{ reserva.livro.capa.url }}" 
                                                 alt="Capa de {{ reserva.livro.titulo }}" 
                                                 class="img-fluid rounded shadow-sm" 
                                                 style="max-height: 120px; object-fit: cover;">
                                        {% else %}
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center shadow-sm" 
                                                 style="height: 120px;">
                                                <i class="fas fa-book fa-2x text-muted"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Book Information -->
                                    <div class="col-md-9">
                                        <h6 class="card-title">{{ reserva.livro.titulo }}</h6>
                                        <p class="text-muted small mb-2">
                                            <i class="fas fa-user me-1"></i>{{ reserva.livro.autor.nome }}
                                        </p>
                                        <p class="mb-2">
                                            <span class="badge bg-secondary">{{ reserva.livro.get_genero_display }}</span>
                                        </p>
                                        
                                        <!-- Reservation Details -->
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-calendar-plus me-1"></i>
                                                    Reservado em:
                                                </small>
                                                <strong>{{ reserva.data_reserva|date:"d/m/Y" }}</strong>
                                            </div>
                                            <div class="col-6">
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-calendar-times me-1"></i>
                                                    Expira em:
                                                </small>
                                                <strong class="{% if reserva.data_expiracao|date:'Y-m-d' <= 'now'|date:'Y-m-d' %}text-danger{% endif %}">
                                                    {{ reserva.data_expiracao|date:"d/m/Y" }}
                                                </strong>
                                            </div>
                                        </div>
                                        
                                        <!-- Status and Actions -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="badge bg-success">
                                                <i class="fas fa-check me-1"></i>Ativa
                                            </span>
                                            
                                            <div class="btn-group btn-group-sm">
                                                <a href="{% url 'biblioteca:livro_detail' reserva.livro.pk %}" 
                                                   class="btn btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <button class="btn btn-outline-warning cancelar-reserva-btn" 
                                                        data-reserva-id="{{ reserva.pk }}" 
                                                        data-livro-titulo="{{ reserva.livro.titulo }}">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Expiration Warning -->
                                        {% if reserva.data_expiracao|date:'Y-m-d' <= 'now'|date:'Y-m-d' %}
                                        <div class="alert alert-warning mt-2 mb-0 py-2" role="alert">
                                            <small>
                                                <i class="fas fa-exclamation-triangle me-1"></i>
                                                <strong>Atenção:</strong> Esta reserva expira hoje!
                                            </small>
                                        </div>
                                        {% elif reserva.data_expiracao|date:'Y-m-d' <= 'now'|date:'Y-m-d'|add:'3' %}
                                        <div class="alert alert-info mt-2 mb-0 py-2" role="alert">
                                            <small>
                                                <i class="fas fa-info-circle me-1"></i>
                                                <strong>Lembrete:</strong> Esta reserva expira em breve.
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Expired Reservations -->
{% if reservas_expirando %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="fas fa-clock me-2"></i>
                    Reservas Expiradas ({{ reservas_expirando|length }})
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-3" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Atenção:</strong> Estas reservas expiraram e podem ser canceladas automaticamente pelo sistema.
                </div>
                
                <div class="row">
                    {% for reserva in reservas_expirando %}
                    <div class="col-lg-6 col-md-12 mb-3">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <div class="row">
                                    <!-- Book Cover -->
                                    <div class="col-md-3 text-center mb-3">
                                        {% if reserva.livro.capa %}
                                            <img src="{{ reserva.livro.capa.url }}" 
                                                 alt="Capa de {{ reserva.livro.titulo }}" 
                                                 class="img-fluid rounded shadow-sm" 
                                                 style="max-height: 120px; object-fit: cover;">
                                        {% else %}
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center shadow-sm" 
                                                 style="height: 120px;">
                                                <i class="fas fa-book fa-2x text-muted"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Book Information -->
                                    <div class="col-md-9">
                                        <h6 class="card-title">{{ reserva.livro.titulo }}</h6>
                                        <p class="text-muted small mb-2">
                                            <i class="fas fa-user me-1"></i>{{ reserva.livro.autor.nome }}
                                        </p>
                                        
                                        <!-- Expiration Info -->
                                        <div class="alert alert-danger py-2 mb-3" role="alert">
                                            <small>
                                                <i class="fas fa-calendar-times me-1"></i>
                                                <strong>Expirada em:</strong> {{ reserva.data_expiracao|date:"d/m/Y" }}
                                            </small>
                                        </div>
                                        
                                        <!-- Actions -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-clock me-1"></i>Expirada
                                            </span>
                                            
                                            <div class="btn-group btn-group-sm">
                                                <a href="{% url 'biblioteca:livro_detail' reserva.livro.pk %}" 
                                                   class="btn btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <button class="btn btn-outline-success renovar-reserva-btn" 
                                                        data-reserva-id="{{ reserva.pk }}" 
                                                        data-livro-titulo="{{ reserva.livro.titulo }}">
                                                    <i class="fas fa-redo"></i>
                                                </button>
                                                <button class="btn btn-outline-danger cancelar-reserva-btn" 
                                                        data-reserva-id="{{ reserva.pk }}" 
                                                        data-livro-titulo="{{ reserva.livro.titulo }}">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Cancelled Reservations -->
{% if reservas_canceladas %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-ban me-2"></i>
                    Reservas Canceladas ({{ reservas_canceladas|length }})
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for reserva in reservas_canceladas %}
                    <div class="col-lg-6 col-md-12 mb-3">
                        <div class="card h-100 border-secondary">
                            <div class="card-body">
                                <div class="row">
                                    <!-- Book Cover -->
                                    <div class="col-md-3 text-center mb-3">
                                        {% if reserva.livro.capa %}
                                            <img src="{{ reserva.livro.capa.url }}" 
                                                 alt="Capa de {{ reserva.livro.titulo }}" 
                                                 class="img-fluid rounded shadow-sm" 
                                                 style="max-height: 120px; object-fit: cover;">
                                        {% else %}
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center shadow-sm" 
                                                 style="height: 120px;">
                                                <i class="fas fa-book fa-2x text-muted"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Book Information -->
                                    <div class="col-md-9">
                                        <h6 class="card-title">{{ reserva.livro.titulo }}</h6>
                                        <p class="text-muted small mb-2">
                                            <i class="fas fa-user me-1"></i>{{ reserva.livro.autor.nome }}
                                        </p>
                                        
                                        <!-- Cancellation Info -->
                                        <div class="alert alert-secondary py-2 mb-3" role="alert">
                                            <small>
                                                <i class="fas fa-calendar-times me-1"></i>
                                                <strong>Cancelada em:</strong> {{ reserva.data_reserva|date:"d/m/Y" }}
                                            </small>
                                        </div>
                                        
                                        <!-- Actions -->
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-ban me-1"></i>Cancelada
                                            </span>
                                            
                                            <div class="btn-group btn-group-sm">
                                                <a href="{% url 'biblioteca:livro_detail' reserva.livro.pk %}" 
                                                   class="btn btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                {% if reserva.livro.is_available %}
                                                <a href="{% url 'biblioteca:reservar_livro' reserva.livro.pk %}" 
                                                   class="btn btn-outline-success">
                                                    <i class="fas fa-bookmark"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- No Reservations Message -->
{% if not reservas_ativas and not reservas_expirando and not reservas_canceladas %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-bookmark fa-4x text-muted mb-3"></i>
                <h3 class="text-muted">Nenhuma Reserva Encontrada</h3>
                <p class="text-muted mb-4">
                    Você ainda não fez nenhuma reserva. Que tal começar explorando nosso acervo?
                </p>
                <div class="d-flex gap-2 justify-content-center">
                    <a href="{% url 'biblioteca:livro_list' %}" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Buscar Livros
                    </a>
                    <a href="{% url 'biblioteca:dashboard' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-home me-2"></i>Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- CSRF Token for AJAX requests -->
{% csrf_token %}

<!-- Hidden inputs for JavaScript -->
<input type="hidden" id="cancelarReservaUrl" value="{% url 'biblioteca:cancelar_reserva' 0 %}">

<!-- Cancel Reservation Modal -->
<div class="modal fade" id="cancelReservaModal" tabindex="-1" aria-labelledby="cancelReservaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="cancelReservaModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmar Cancelamento
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">
                    Tem certeza que deseja cancelar a reserva do livro 
                    <strong id="livroTituloModal"></strong>?
                </p>
                <div class="alert alert-warning mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Atenção:</strong> Esta ação não pode ser desfeita.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-warning" id="confirmCancelBtn">
                    <i class="fas fa-check me-2"></i>Confirmar Cancelamento
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Reservation Rules Info -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Regras das Reservas
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h6 class="text-info">Limites:</h6>
                        <ul class="text-muted small mb-0">
                            <li>Máximo de 3 reservas ativas por usuário</li>
                            <li>Reservas expiram em 7 dias</li>
                            <li>Livros indisponíveis podem ser reservados</li>
                        </ul>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h6 class="text-info">Dicas:</h6>
                        <ul class="text-muted small mb-0">
                            <li>Monitore as datas de expiração</li>
                            <li>Renove reservas expiradas se necessário</li>
                            <li>Cancelar reservas não utilizadas</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Card styling */
.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-1px);
}

/* Status badge styling */
.badge {
    font-size: 0.8rem;
}

/* Button group styling */
.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

/* Alert styling */
.alert {
    border: none;
    border-radius: 6px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .card-body {
        padding: 1.5rem;
    }
    
    .d-flex.gap-2 {
        flex-direction: column;
    }
    
    .d-flex.gap-2 .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>

// Function to cancel reservation
function cancelarReserva(reservaId, livroTitulo) {
    try {
        // Armazenar dados da reserva para o modal
        window.currentReservaId = reservaId;
        window.currentLivroTitulo = livroTitulo;
        
        // Verificar se o modal existe
        const modalElement = document.getElementById('cancelReservaModal');
        if (!modalElement) {
            throw new Error('Modal de cancelamento não encontrado');
        }
        
        // Atualizar título do livro no modal
        const tituloElement = document.getElementById('livroTituloModal');
        if (tituloElement) {
            tituloElement.textContent = livroTitulo;
        }
        
        // Verificar se Bootstrap está disponível
        if (typeof bootstrap === 'undefined' || !bootstrap.Modal) {
            // Fallback: usar confirm padrão
            if (confirm(`Tem certeza que deseja cancelar a reserva do livro "${livroTitulo}"?\n\nEsta ação não pode ser desfeita.`)) {
                executarCancelamento();
            }
            return;
        }
        
        // Mostrar modal Bootstrap
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
        
    } catch (error) {
        console.error('Erro ao abrir modal:', error);
        // Fallback: usar confirm padrão
        if (confirm(`Tem certeza que deseja cancelar a reserva do livro "${livroTitulo}"?\n\nEsta ação não pode ser desfeita.`)) {
            executarCancelamento();
        }
    }
}

// Function to execute cancellation after confirmation
function executarCancelamento() {
    const reservaId = window.currentReservaId;
    const livroTitulo = window.currentLivroTitulo;
    
    if (!reservaId) {
        console.error('ID da reserva não encontrado');
        return;
    }
    
    // Desabilitar botão de confirmação
    const confirmBtn = document.getElementById('confirmCancelBtn');
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Cancelando...';
    
    try {
        // Obter token CSRF de forma robusta
        let csrfToken = '';
        const csrfElement = document.querySelector('[name=csrfmiddlewaretoken]');
        if (csrfElement) {
            csrfToken = csrfElement.value;
        } else {
            // Fallback: tentar obter do cookie
            csrfToken = getCookie('csrftoken');
        }
        
        if (!csrfToken) {
            throw new Error('Token CSRF não encontrado');
        }
        
        // Criar formulário e enviar
        const form = document.createElement('form');
        form.method = 'POST';
        
        // Obter URL base do input hidden
        const urlBase = document.getElementById('cancelarReservaUrl').value;
        form.action = urlBase.replace('0', reservaId);
        
        // Adicionar token CSRF
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        
        // Adicionar campo para identificar a reserva
        const reservaInput = document.createElement('input');
        reservaInput.type = 'hidden';
        reservaInput.name = 'reserva_id';
        reservaInput.value = reservaId;
        form.appendChild(reservaInput);
        
        // Enviar formulário
        document.body.appendChild(form);
        form.submit();
        
    } catch (error) {
        console.error('Erro ao cancelar reserva:', error);
        
        // Reabilitar botão em caso de erro
        confirmBtn.disabled = false;
        confirmBtn.innerHTML = '<i class="fas fa-check me-2"></i>Confirmar Cancelamento';
        
        // Mostrar mensagem de erro mais específica
        if (error.message.includes('CSRF')) {
            alert('Erro de segurança. Recarregue a página e tente novamente.');
        } else {
            alert('Erro ao cancelar reserva. Tente novamente.');
        }
    }
}

// Helper function to get cookie value
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Function to renew expired reservation
function renovarReserva(reservaId, livroTitulo) {
    if (confirm(`Deseja renovar a reserva do livro "${livroTitulo}"? A nova reserva expirará em 7 dias.`)) {
        // Here you would typically make an AJAX call to renew the reservation
        // For now, we'll show a message
        alert('Funcionalidade de renovação será implementada em breve!');
    }
}

// Event listeners for reservation buttons
document.addEventListener('DOMContentLoaded', function() {
    // Confirm cancellation button
    const confirmCancelBtn = document.getElementById('confirmCancelBtn');
    if (confirmCancelBtn) {
        confirmCancelBtn.addEventListener('click', executarCancelamento);
    } else {
        console.warn('Botão de confirmação de cancelamento não encontrado');
    }
    
    // Cancel reservation buttons
    document.querySelectorAll('.cancelar-reserva-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const reservaId = this.getAttribute('data-reserva-id');
            const livroTitulo = this.getAttribute('data-livro-titulo');
            cancelarReserva(reservaId, livroTitulo);
        });
    });
    
    // Renew reservation buttons
    document.querySelectorAll('.renovar-reserva-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const reservaId = this.getAttribute('data-reserva-id');
            const livroTitulo = this.getAttribute('data-livro-titulo');
            renovarReserva(reservaId, livroTitulo);
        });
    });
    
    // Verificar se todos os elementos necessários estão presentes
    const modalElement = document.getElementById('cancelReservaModal');
    const tituloElement = document.getElementById('livroTituloModal');
    
    if (!modalElement) {
        console.error('Modal de cancelamento não encontrado');
    }
    if (!tituloElement) {
        console.error('Elemento de título do modal não encontrado');
    }
});

// Auto-refresh page every 5 minutes to update expiration status
setTimeout(function() {
    location.reload();
}, 300000); // 5 minutes

// Show notification for expiring reservations
document.addEventListener('DOMContentLoaded', function() {
    const expiringReservas = document.querySelectorAll('.alert-warning');
    if (expiringReservas.length > 0) {
        // Show browser notification if supported
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Reservas Expirando', {
                body: `Você tem ${expiringReservas.length} reserva(s) expirando em breve.`,
                icon: '/static/favicon.ico'
            });
        }
    }
});

// Request notification permission
if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
}
</script>
{% endblock %}
    